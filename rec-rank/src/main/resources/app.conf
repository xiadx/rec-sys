label {
  output-path="/user/xiadinxin/rec-sys/rec-rank/label/index/v1/{dt}"
}

usf {
  interval=30
  npartitions=2000
  storage-level="memory_and_disk_ser"
  days=[30,15,7,3,1]
  output-path="/user/xiadinxin/rec-sys/rec-rank/feature/usf/index/v1/{dt}"
}

isf {
  interval=30
  npartitions=2000
  storage-level="memory_and_disk_ser"
  days=[30,15,7,3,1]
  output-path="/user/xiadinxin/rec-sys/rec-rank/feature/isf/index/v1/{dt}"
}

ufm {
  using-columns=["open_udid"]
  input-path=[
    "/user/xiadinxin/rec-sys/rec-rank/feature/usf/index/v1/{dt}"
  ]
  output-path="/user/xiadinxin/rec-sys/rec-rank/feature/ufm/v1/{dt}"
  prefix="ufm"
  joiner="_"
  output-hive="recommend.ufm"
}

ifm {
  using-columns=["item_id","item_type"]
  input-path=[
    "/user/xiadinxin/rec-sys/rec-rank/feature/isf/index/v1/{dt}"
  ]
  output-path="/user/xiadinxin/rec-sys/rec-rank/feature/ifm/v1/{dt}"
  prefix="ifm"
  joiner="_"
  output-hive="recommend.ifm"
}

merge {
  label {
    path="/user/xiadinxin/rec-sys/rec-rank/label/index/v1/{dt}"
    using-columns=["open_udid","item_id","item_type","show_cycle_id"]
    label-column="label"
  }
  ufm {
    path="/user/xiadinxin/rec-sys/rec-rank/feature/ufm/v1/{dt}"
    using-columns=["open_udid"]
  }
  ifm {
    path="/user/xiadinxin/rec-sys/rec-rank/feature/ifm/v1/{dt}"
    using-columns=["item_id","item_type"]
  }
  output-path="/user/xiadinxin/rec-sys/rec-rank/merge/index/v1/{dt}"
}

sample {
  scene="index"
  model="xgb"
  version="v1"
  input-path="/user/xiadinxin/rec-sys/rec-rank/merge/index/v1/{dt}"
  sample-path="/user/xiadinxin/rec-sys/rec-rank/sample/index/{model}.{version}.[train|test]"
  output-path="/user/xiadinxin/rec-sys/rec-rank/sample/index/{model}.{version}.[train|test].libsvm"
  npartitions=200
  dt-part=false
  days-list {
    train {
      start="20200815"
      end="20200815"
      days=[]
    }
    test {
      start="20200816"
      end="20200816"
      days=[]
    }
  }
  label="label"
  sparse="features"
  ignore=["open_udid","item_id","label","dt"]
  where=""
  raw=[
    "index_user_show_30"
    "index_user_click_30"
    "index_user_ctr_30"
    "index_user_show_15"
    "index_user_click_15"
    "index_user_ctr_15"
    "index_user_show_7"
    "index_user_click_7"
    "index_user_ctr_7"
    "index_user_show_3"
    "index_user_click_3"
    "index_user_ctr_3"
    "index_user_show_1"
    "index_user_click_1"
    "index_user_ctr_1"
    "item_type"
    "index_item_show_30"
    "index_item_click_30"
    "index_item_ctr_30"
    "index_item_show_15"
    "index_item_click_15"
    "index_item_ctr_15"
    "index_item_show_7"
    "index_item_click_7"
    "index_item_ctr_7"
    "index_item_show_3"
    "index_item_click_3"
    "index_item_ctr_3"
    "index_item_show_1"
    "index_item_click_1"
    "index_item_ctr_1"
  ]
  edu=[

  ]
  cos=[

  ]
  match=[

  ]
}

train {
  scene="index"
  model="xgb"
  version="v1"
  input-path="/user/xiadinxin/rec-sys/rec-rank/sample/index/{model}.{version}.[train|test]"
  model-path="/user/xiadinxin/rec-sys/rec-rank/model/index/xgb.v1"
  native-booster="/home/operation/xiadingxin/Workspace/rec-sys/data/rec-rank/model/index/xgb.v1"
  label="label"
  sparse="features"
  prediction="probability"
  metric="areaUnderROC"
  ignore=["open_udid","item_id","dt"]
  param {
    objective="binary:logistic"
    eta=0.1
    max_depth=7
    min_child_weight=1
    gamma=0
    subsample=0.8
    colsample_bytree=0.8
    scale_pos_weight=1
    num_round=2
    eval_metric="auc"
    num_workers=2
  }
}

bf {
  fconf=[
    {
      id=1
      mark="u"
      name="open_udid"
      alias="ou"
      exp=""
      dtl=""
      typ="string"
      value="-1"
      status="0"
    }
    {
      id=2
      mark="u"
      name="index_user_show_30"
      alias="ius30"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=3
      mark="u"
      name="index_user_click_30"
      alias="iuc30"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=4
      mark="u"
      name="index_user_ctr_30"
      alias="iuc30"
      exp=""
      dtl=""
      typ="double"
      value=".0"
      status="1"
    }
    {
      id=5
      mark="u"
      name="index_user_show_15"
      alias="ius15"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=6
      mark="u"
      name="index_user_click_15"
      alias="iuc15"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=7
      mark="u"
      name="index_user_ctr_15"
      alias="iuc15"
      exp=""
      dtl=""
      typ="double"
      value=".0"
      status="1"
    }
    {
      id=8
      mark="u"
      name="index_user_show_7"
      alias="ius7"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=9
      mark="u"
      name="index_user_click_7"
      alias="iuc7"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=10
      mark="u"
      name="index_user_ctr_7"
      alias="iuc7"
      exp=""
      dtl=""
      typ="double"
      value=".0"
      status="1"
    }
    {
      id=11
      mark="u"
      name="index_user_show_3"
      alias="ius3"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=12
      mark="u"
      name="index_user_click_3"
      alias="iuc3"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=13
      mark="u"
      name="index_user_ctr_3"
      alias="iuc3"
      exp=""
      dtl=""
      typ="double"
      value=".0"
      status="1"
    }
    {
      id=14
      mark="u"
      name="index_user_show_1"
      alias="ius1"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=15
      mark="u"
      name="index_user_click_1"
      alias="iuc1"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=16
      mark="u"
      name="index_user_ctr_1"
      alias="iuc1"
      exp=""
      dtl=""
      typ="double"
      value=".0"
      status="1"
    }
    {
      id=1
      mark="i"
      name="item_id"
      alias="ii"
      exp=""
      dtl=""
      typ="long"
      value="-1"
      status="0"
    }
    {
      id=2
      mark="i"
      name="item_type"
      alias="it"
      exp=""
      dtl=""
      typ="integer"
      value="-1"
      status="1"
    }
    {
      id=3
      mark="i"
      name="index_item_show_30"
      alias="iis30"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=4
      mark="i"
      name="index_item_click_30"
      alias="iic30"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=5
      mark="i"
      name="index_item_ctr_30"
      alias="iic30"
      exp=""
      dtl=""
      typ="double"
      value=".0"
      status="1"
    }
    {
      id=6
      mark="i"
      name="index_item_show_15"
      alias="iis15"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=7
      mark="i"
      name="index_item_click_15"
      alias="iic15"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=8
      mark="i"
      name="index_item_ctr_15"
      alias="iic15"
      exp=""
      dtl=""
      typ="double"
      value=".0"
      status="1"
    }
    {
      id=9
      mark="i"
      name="index_item_show_7"
      alias="iis7"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=10
      mark="i"
      name="index_item_click_7"
      alias="iic7"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=11
      mark="i"
      name="index_item_ctr_7"
      alias="iic7"
      exp=""
      dtl=""
      typ="double"
      value=".0"
      status="1"
    }
    {
      id=12
      mark="i"
      name="index_item_show_3"
      alias="iis3"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=13
      mark="i"
      name="index_item_click_3"
      alias="iic3"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=14
      mark="i"
      name="index_item_ctr_3"
      alias="iic3"
      exp=""
      dtl=""
      typ="double"
      value=".0"
      status="1"
    }
    {
      id=15
      mark="i"
      name="index_item_show_1"
      alias="iis1"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=16
      mark="i"
      name="index_item_click_1"
      alias="iic1"
      exp=""
      dtl=""
      typ="long"
      value="0"
      status="1"
    }
    {
      id=17
      mark="i"
      name="index_item_ctr_1"
      alias="iic1"
      exp=""
      dtl=""
      typ="double"
      value=".0"
      status="1"
    }
    {
      id=1
      mark="c"
      name="label"
      alias="label"
      exp=""
      dtl=""
      typ="integer"
      value="-1"
      status="1"
    }
    {
      id=2
      mark="c"
      name="dt"
      alias="dt"
      exp=""
      dtl=""
      typ="string"
      value="-1"
      status="1"
    }
    {
      id=3
      mark="c"
      name="pos_channel_id"
      alias="pci"
      exp=""
      dtl=""
      typ="string"
      value="-1"
      status="1"
    }
    {
      id=4
      mark="c"
      name="show_cycle_id"
      alias="sci"
      exp=""
      dtl=""
      typ="string"
      value="-1"
      status="1"
    }
    {
      id=5
      mark="c"
      name="event_code"
      alias="ec"
      exp=""
      dtl=""
      typ="string"
      value="-1"
      status="1"
    }
    {
      id=6
      mark="c"
      name="biz_line"
      alias="bl"
      exp=""
      dtl=""
      typ="string"
      value="-1"
      status="1"
    }
    {
      id=7
      mark="c"
      name="scene"
      alias="scene"
      exp=""
      dtl=""
      typ="string"
      value="-1"
      status="1"
    }
    {
      id=8
      mark="c"
      name="app_code"
      alias="ac"
      exp=""
      dtl=""
      typ="string"
      value="-1"
      status="1"
    }
  ]
}

af {
  fconf=[
    {
      id=1
      mark="u"
      name="open_udid"
      alias="ou"
      exp=""
      dtl=""
      vtyp="string"
      ftyp="raw"
      value="-1"
      status="1"
      source="user"
    }
    {
      id=2
      mark="u"
      name="index_user_show_30"
      alias="ius30"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="user"
    }
    {
      id=3
      mark="u"
      name="index_user_click_30"
      alias="iuc30"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="user"
    }
    {
      id=4
      mark="u"
      name="index_user_ctr_30"
      alias="iuc30"
      exp=""
      dtl=""
      vtyp="double"
      ftyp="raw"
      value=".0"
      status="1"
      source="user"
    }
    {
      id=5
      mark="u"
      name="index_user_show_15"
      alias="ius15"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="user"
    }
    {
      id=6
      mark="u"
      name="index_user_click_15"
      alias="iuc15"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="user"
    }
    {
      id=7
      mark="u"
      name="index_user_ctr_15"
      alias="iuc15"
      exp=""
      dtl=""
      vtyp="double"
      ftyp="raw"
      value=".0"
      status="1"
      source="user"
    }
    {
      id=8
      mark="u"
      name="index_user_show_7"
      alias="ius7"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="user"
    }
    {
      id=9
      mark="u"
      name="index_user_click_7"
      alias="iuc7"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="user"
    }
    {
      id=10
      mark="u"
      name="index_user_ctr_7"
      alias="iuc7"
      exp=""
      dtl=""
      vtyp="double"
      ftyp="raw"
      value=".0"
      status="1"
      source="user"
    }
    {
      id=11
      mark="u"
      name="index_user_show_3"
      alias="ius3"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="user"
    }
    {
      id=12
      mark="u"
      name="index_user_click_3"
      alias="iuc3"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="user"
    }
    {
      id=13
      mark="u"
      name="index_user_ctr_3"
      alias="iuc3"
      exp=""
      dtl=""
      vtyp="double"
      ftyp="raw"
      value=".0"
      status="1"
      source="user"
    }
    {
      id=14
      mark="u"
      name="index_user_show_1"
      alias="ius1"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="user"
    }
    {
      id=15
      mark="u"
      name="index_user_click_1"
      alias="iuc1"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="user"
    }
    {
      id=16
      mark="u"
      name="index_user_ctr_1"
      alias="iuc1"
      exp=""
      dtl=""
      vtyp="double"
      ftyp="raw"
      value=".0"
      status="1"
      source="user"
    }
    {
      id=1
      mark="i"
      name="item_id"
      alias="ii"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="item"
    }
    {
      id=2
      mark="i"
      name="item_type"
      alias="it"
      exp=""
      dtl=""
      vtyp="integer"
      ftyp="raw"
      value="0"
      status="1"
      source="item"
    }
    {
      id=3
      mark="i"
      name="index_item_show_30"
      alias="iis30"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="item"
    }
    {
      id=4
      mark="i"
      name="index_item_click_30"
      alias="iic30"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="item"
    }
    {
      id=5
      mark="i"
      name="index_item_ctr_30"
      alias="iic30"
      exp=""
      dtl=""
      vtyp="double"
      ftyp="raw"
      value=".0"
      status="1"
      source="item"
    }
    {
      id=6
      mark="i"
      name="index_item_show_15"
      alias="iis15"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="item"
    }
    {
      id=7
      mark="i"
      name="index_item_click_15"
      alias="iic15"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="item"
    }
    {
      id=8
      mark="i"
      name="index_item_ctr_15"
      alias="iic15"
      exp=""
      dtl=""
      vtyp="double"
      ftyp="raw"
      value=".0"
      status="1"
      source="item"
    }
    {
      id=9
      mark="i"
      name="index_item_show_7"
      alias="iis7"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="item"
    }
    {
      id=10
      mark="i"
      name="index_item_click_7"
      alias="iic7"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="item"
    }
    {
      id=11
      mark="i"
      name="index_item_ctr_7"
      alias="iic7"
      exp=""
      dtl=""
      vtyp="double"
      ftyp="raw"
      value=".0"
      status="1"
      source="item"
    }
    {
      id=12
      mark="i"
      name="index_item_show_3"
      alias="iis3"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="item"
    }
    {
      id=13
      mark="i"
      name="index_item_click_3"
      alias="iic3"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="item"
    }
    {
      id=14
      mark="i"
      name="index_item_ctr_3"
      alias="iic3"
      exp=""
      dtl=""
      vtyp="double"
      ftyp="raw"
      value=".0"
      status="1"
      source="item"
    }
    {
      id=15
      mark="i"
      name="index_item_show_1"
      alias="iis1"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="item"
    }
    {
      id=16
      mark="i"
      name="index_item_click_1"
      alias="iic1"
      exp=""
      dtl=""
      vtyp="long"
      ftyp="raw"
      value="0"
      status="1"
      source="item"
    }
    {
      id=17
      mark="i"
      name="index_item_ctr_1"
      alias="iic1"
      exp=""
      dtl=""
      vtyp="double"
      ftyp="raw"
      value=".0"
      status="1"
      source="item"
    }
    {
      id=1
      mark="c"
      name="label"
      alias="l"
      exp=""
      dtl=""
      vtyp="integer"
      ftyp="raw"
      value="-1"
      status="1"
      source="context"
    }
  ]
}